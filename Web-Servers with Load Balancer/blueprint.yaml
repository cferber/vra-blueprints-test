name: Web-Servers with Load Balancer
version: 9
description: CentOS with on-demand Network created by NSX
formatVersion: 1
inputs:
  webserver-count:
    type: integer
    description: ''
    default: '2'
    title: Number of Webservers
    minimum: 2
    maximum: 4
resources:
  Cloud_SecurityGroup_1:
    type: Cloud.SecurityGroup
    metadata:
      layoutPosition:
        - 0
        - 0
    properties:
      securityGroupType: existing
      constraints:
        - tag: 'sg:webservers'
  Cloud_LoadBalancer_1:
    type: Cloud.LoadBalancer
    metadata:
      layoutPosition:
        - 0
        - 1
    properties:
      routes:
        - port: '80'
          protocol: tcp
          healthCheckConfiguration:
            port: '80'
            protocol: tcp
      network: '${resource.Cloud_NSX_Network_1.id}'
      instances:
        - '${resource.Cloud_Machine_1.id}'
      internetFacing: false
  Cloud_Machine_1:
    type: Cloud.Machine
    dependsOn:
      - Cloud_SecurityGroup_1
    metadata:
      layoutPosition:
        - 0
        - 2
    properties:
      count: '${input.webserver-count}'
      flavor: CF-Small
      imageRef: TEMP-CentOS7-02/snap09
      customizationSpec: vra-linux-custom
      networks:
        - network: '${resource.Cloud_NSX_Network_1.id}'
          securityGroups:
            - '${resource.Cloud_SecurityGroup_1.id}'
  Cloud_NSX_Network_1:
    type: Cloud.NSX.Network
    metadata:
      layoutPosition:
        - 1
        - 0
    properties:
      networkType: routed

